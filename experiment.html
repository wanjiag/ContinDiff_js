<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych-6.0.5/jspsych.js"></script>
    <script src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.0.5/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.0.5/plugins/jspsych-survey-multi-choice.js" type="text/javascript"></script>
    <link href="jspsych-6.0.5/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body></body>
  <script>
    		var timeline = [];

    		var welcome = {
    			type: "html-keyboard-response",
  				stimulus: "Welcome to the experiment. Press any key to start."
			};

			/*
			var demographics = {
		       type: 'survey-multi-choice',
		       questions: ['Gender:',
		                    'Age:',
		                    ],
		       options: [['Female', 'Male', 'Prefer not to answer'],
		                ['Less than 18', '18-25', '26-35', '36-60', '61+'],
		              ],
		       required: [true, true],
		       horizontal: true,
		       preamble: '<p>Before we begin, please complete the following demographic information: </p>',
		       timing_post_trial: 0
		       };
			*/

			var instructions = {
  				type: "html-keyboard-response",
  				stimulus: "<p>In this experiment, three pictures will appear on " +
      				"the screen.</p><p>Try your best to memorize the pictures.</p><p>" +
      				"These 3 pictures will be replaced by three scrambled pictures.</p><p>" +
      				"Then, one of the scrambled pictures will be replaced by another picture.</p><p>"+
      				"You will need to judge whether the reappeared picture is the same as the picture that was at the same location</p><p>" +
      				"<p>If the picture is <strong>the same</strong>, press the letter J.</p><p> " +
      				"<p>If the picture is <strong>differet</strong>, press the letter K.</p><p> " +
      				"<p>Press any key to begin.</p>"
				};


		    /* test trials */
		    var test_stimuli = [
		      { stimulus: ['stimuli/scene/pairs/A1.jpg', 'stimuli/scene/pairs/B1.jpg', 'stimuli/scene/pairs/B1.jpg'], data: {test_part: 'test', correct_response: 'j'}},
		      { stimulus: 'stimuli/scene/pairs/B1.jpg', data: {test_part: 'test', correct_response: 'k'}}
		    ];

		    var fixation = {
		      type: 'html-keyboard-response',
		      stimulus: '<div style="font-size:60px;">+</div>',
		      choices: jsPsych.NO_KEYS,
		      trial_duration: 1000,
		      data: {test_part: 'fixation'}
		    }

		    var test = {
		      type: "image-keyboard-response",
		      stimulus: jsPsych.timelineVariable('stimulus'),
		      choices: ['j', 'k'],
			  data: jsPsych.timelineVariable('data'),
			  on_finish: function(data){
			    data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
			  }
		    }

		    var test_procedure = {
		      timeline: [fixation, test, fixation],
		      timeline_variables: test_stimuli,
  			  randomize_order: true
		    }



		    var debrief_block = {
			  type: "html-keyboard-response",
			  stimulus: function() {

			    var trials = jsPsych.data.get().filter({test_part: 'test'});
			    var correct_trials = trials.filter({correct: true});
			    var accuracy = Math.round(correct_trials.count() / trials.count() * 100);
			    var rt = Math.round(correct_trials.select('rt').mean());

			    return "<p>You responded correctly on "+accuracy+"% of the trials.</p>"+
			    "<p>Your average response time was "+rt+"ms.</p>"+
			    "<p>Press any key to complete the experiment. Thank you!</p>";

			  }
			};

			timeline.push(welcome);
			timeline.push(instructions);
			timeline.push(test_procedure);
			timeline.push(debrief_block);

		    /* start the experiment */
		    jsPsych.init({
		      timeline: timeline,
		      on_finish: function() {
		        jsPsych.data.displayData();
		      }
		    });

	</script>
</html>